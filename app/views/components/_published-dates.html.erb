<%
  published ||= false
  data ||= {}
  last_updated ||= false
  link_to_history ||= false
  notification_button_visible ||= false

  history ||= []
  history = Array(history)
  id = "history" if history.any?
  data[:module] = "gem-toggle" if history.any?

  classes = %w(app-c-published-dates)
  classes << "app-c-published-dates--history" if history.any?
  # the wrapper needs some extra margin on the bottom when it is followed by the page notification button
  classes << GovukPublishingComponents::Presenters::SharedHelper.new({margin_bottom: 2}).get_margin_bottom if notification_button_visible
%>
<% if published || last_updated %>
<%= content_tag :div, class: classes, data: data, id: id, lang: "en" do %>
  <% if published %>
    <%= t('components.published_dates.published', date: published) %>
  <% end %>
  <% if last_updated %>
    <% if published %><br /><% end %><%= t('components.published_dates.last_updated', date: last_updated) %>
    <% if link_to_history && history.empty? %>
      &mdash; <a href="#history" class="app-c-published-dates__history-link govuk-link"><%= t('components.published_dates.see_all_updates', locale: :en) %></a>
    <% elsif history.any? %>
      <a href="#full-history"
      class="app-c-published-dates__toggle govuk-link"
      data-controls="full-history"
      data-expanded="false"
      data-toggled-text="&#45;&nbsp;<%= t('components.published_dates.hide_all_updates', locale: :en) %>">&#43;&nbsp;<%= t('components.published_dates.show_all_updates', locale: :en) %></a>
      <div class="app-c-published-dates__change-history js-hidden" id="full-history">
        <ol class="app-c-published-dates__list">
          <% history.each do |change| %>
            <li class="app-c-published-dates__change-item">
              <time class="app-c-published-dates__change-date timestamp" datetime="<%= change[:timestamp] %>"><%= change[:display_time] %></time>
              <p class="app-c-published-dates__change-note"><%= change[:note].strip %></p>
            </li>
          <% end %>
        </ol>
      </div>
    <% end %>
  <% end %>
<% end %>
<% end %>
